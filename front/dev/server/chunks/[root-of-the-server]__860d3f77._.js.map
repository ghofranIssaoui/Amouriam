{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/amourium-e-commerce-app1/app/api/orders/route.ts"],"sourcesContent":["// app/api/orders/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\n\n// Handle GET request to fetch orders\nexport async function GET(request: NextRequest) {\n  const authHeader = request.headers.get('authorization');\n  const token = authHeader?.split(' ')[1];\n  \n  if (!token) {\n    return NextResponse.json(\n      { message: 'Authentification requise' },\n      { status: 401 }\n    );\n  }\n\n  try {\n    const apiUrl = process.env.NEXT_PUBLIC_API_URL?.replace('/api', '') || 'http://localhost:5000';\n    \n    // Try both endpoints for compatibility\n    let response;\n    try {\n      response = await fetch(`${apiUrl}/api/orders`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        cache: 'no-store',\n      });\n    } catch (error) {\n      console.log('First endpoint failed, trying /my-orders...');\n      response = await fetch(`${apiUrl}/api/my-orders`, {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        cache: 'no-store',\n      });\n    }\n\n    const data = await response.json().catch(() => ({}));\n    \n    if (!response.ok) {\n      console.error('Failed to fetch orders:', {\n        status: response.status,\n        statusText: response.statusText,\n        data\n      });\n      \n      return NextResponse.json(\n        { \n          message: data.message || 'Échec de la récupération des commandes',\n          details: data.details\n        },\n        { status: response.status }\n      );\n    }\n\n    return NextResponse.json(Array.isArray(data) ? data : []);\n  } catch (error: any) {\n    console.error('Error in orders API route:', error);\n    return NextResponse.json(\n      { \n        message: 'Erreur interne du serveur',\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined\n      },\n      { status: 500 }\n    );\n  }\n}\n\n// Handle POST request to create a new order\nexport async function POST(request: NextRequest) {\n  try {\n    const orderData = await request.json();\n    const authHeader = request.headers.get('authorization');\n    const token = authHeader?.split(' ')[1];\n    \n    if (!token) {\n      return NextResponse.json(\n        { message: 'Authentication required' },\n        { status: 401 }\n      );\n    }\n\n    const apiUrl = process.env.NEXT_PUBLIC_API_URL?.replace('/api', '') || 'http://localhost:5000';\n    const response = await fetch(`${apiUrl}/api/orders`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`,\n      },\n      body: JSON.stringify(orderData),\n    });\n\n    const data = await response.json().catch(() => ({}));\n    \n    if (!response.ok) {\n      console.error('Backend error:', {\n        status: response.status,\n        statusText: response.statusText,\n        data\n      });\n      return NextResponse.json(\n        { \n          message: data.message || 'Failed to create order',\n          details: data.details\n        },\n        { status: response.status }\n      );\n    }\n\n    return NextResponse.json(data);\n  } catch (error: any) {\n    console.error('Order creation error:', error);\n    return NextResponse.json(\n      { \n        message: 'Internal server error',\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined\n      },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"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"}}]
}